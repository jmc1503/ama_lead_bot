<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AMA Lead Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="images/logo.png" />
  <style>
    :root {
      color-scheme: light dark;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      max-width: 720px;
      margin: 2rem auto;
      padding: 0 1rem 3rem;
      line-height: 1.5;
    }

    header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    header img {
      height: 40px;
      width: auto;
      border-radius: 8px;
    }

    h1 {
      margin: 0;
      font-size: 1.6rem;
    }

    form {
      display: grid;
      gap: 1rem;
    }

    label {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
      font-size: 0.9rem;
      font-weight: 600;
    }

    input,
    select,
    textarea,
    button {
      font: inherit;
      padding: 0.45rem 0.55rem;
      border-radius: 6px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: rgba(15, 23, 42, 0.02);
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #1d9bf0;
      box-shadow: 0 0 0 1px rgba(29, 155, 240, 0.5);
      background: rgba(15, 23, 42, 0.01);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
      white-space: pre-wrap;
    }

    .field-hint {
      font-size: 0.8rem;
      font-weight: 400;
      opacity: 0.7;
    }

    .field-row {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .field-row > label {
      flex: 1 1 160px;
    }

    .section-heading {
      margin-top: 0.75rem;
      font-size: 0.85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      opacity: 0.8;
    }

    .optional-group {
      border: 1px solid rgba(148, 163, 184, 0.6);
      border-radius: 10px;
      padding: 0.65rem 0.75rem 0.75rem;
      display: grid;
      gap: 0.6rem;
    }

    .optional-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.85rem;
    }

    .optional-header-main {
      font-weight: 600;
    }

    .optional-toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-weight: 500;
    }

    .optional-toggle input[type="checkbox"] {
      width: auto;
      accent-color: #1d9bf0;
    }

    .optional-body {
      display: grid;
      gap: 0.6rem;
    }

    .checkbox-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      font-size: 0.85rem;
    }

    .checkbox-row label {
      flex-direction: row;
      align-items: center;
      gap: 0.35rem;
      font-weight: 500;
    }

    .checkbox-row input[type="checkbox"] {
      width: auto;
      accent-color: #1d9bf0;
    }

    .risk-select {
      max-width: 120px;
    }

    button[type="submit"] {
      margin-top: 0.5rem;
      cursor: pointer;
      background: #1d9bf0;
      color: white;
      border: none;
      font-weight: 600;
      padding: 0.6rem 0.95rem;
      border-radius: 999px;
      justify-self: flex-start;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    button[type="submit"]:hover:not(:disabled) {
      filter: brightness(1.05);
    }

    button[type="submit"]:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .status {
      margin-top: 0.75rem;
      font-size: 0.85rem;
      min-height: 1em;
    }

    .status.error {
      color: #dc2626;
    }

    .status.success {
      color: #16a34a;
    }

    @media (max-width: 520px) {
      body {
        margin-top: 1.25rem;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      h1 {
        font-size: 1.4rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <img src="images/logo.png" alt="AMA logo" />
    <div>
      <h1>AMA Lead Console</h1>
    </div>
  </header>

  <form id="leadForm" autocomplete="off">
    <!-- Lead meta -->
    <div class="field-row">
      <label>
        Lead type
        <select name="leadType" required>
          <option value="">Select type…</option>
          <option value="sneakers">Sneakers</option>
          <option value="flips">Flips</option>
          <option value="pokemon">Pokemon</option>
          <option value="lunch_money">Lunch Money</option>
        </select>
        <span class="field-hint">Controls channel and role ping.</span>
      </label>

      <label>
        Title
        <input
          type="text"
          name="title"
          required
          minlength="3"
          maxlength="150"
          placeholder='e.g. Nike Kobe 6 Protro "Total Orange" – SNKRS UK'
        />
        <span class="field-hint">What members see as the lead title.</span>
      </label>
    </div>

    <div class="section-heading">Core details</div>

    <!-- Pricing -->
    <div class="optional-group">
      <div class="optional-header">
        <span class="optional-header-main">Pricing</span>
        <label class="optional-toggle">
          <input type="checkbox" name="includePricing" checked />
          Include
        </label>
      </div>

      <div class="optional-body">
        <div class="field-row">
          <label>
            RRP (£)
            <input
              type="text"
              name="rrp"
              inputmode="decimal"
              placeholder="e.g. 100"
            />
          </label>

          <label>
            Resell (£)
            <input
              type="text"
              name="resellPrice"
              inputmode="decimal"
              placeholder="e.g. 150"
            />
          </label>
        </div>
        <span class="field-hint">If included, both RRP and Resell are required – profit is auto-calculated.</span>
      </div>
    </div>

<!-- Drop date -->
<div class="optional-group">
  <div class="optional-header">
    <span class="optional-header-main">Drop date</span>
    <label class="optional-toggle">
      <input type="checkbox" name="includeDropDate" checked />
      Include
    </label>
  </div>

  <div class="optional-body">
    <div class="field-row" style="align-items: flex-end; gap: 1.5rem;">
      
      <label style="flex: 1 0 150px;">
        
        <input
          type="datetime-local"
          name="dropDate"
          step="900"
          style="width: 85%;"
        />
      </label>

      <label class="optional-toggle" style="flex: 0 0 auto; margin-bottom: 4px; margin-left: 0.5rem;">
        <input type="checkbox" name="liveNow" />
        Live now
      </label>

    </div>

    <span class="field-hint">
      Uses your local time. Leave empty and tick “Live now” if it’s already live.
    </span>
  </div>
</div>

    <!-- Lead location -->
    <div class="optional-group">
      <div class="optional-header">
        <span class="optional-header-main">Lead location</span>
        <label class="optional-toggle">
          <input type="checkbox" name="includeLeadLocation" checked />
          Include
        </label>
      </div>
      <div class="optional-body">
          <input
            type="text"
            name="leadLocation"
            maxlength="160"
            placeholder="e.g. Nike SNKRS UK or https://www.nike.com/..."
          />
          <span class="field-hint">Can be a store name or a direct product URL.</span>
        </label>
      </div>
    </div>

    <!-- Resell platforms -->
    <div class="optional-group">
      <div class="optional-header">
        <span class="optional-header-main">Resell platforms</span>
        <label class="optional-toggle">
          <input type="checkbox" name="includePlatforms" checked />
          Include
        </label>
      </div>
      <div class="optional-body">
        <div class="checkbox-row">
          <label>
            <input type="checkbox" name="platform_ebay" />
            eBay
          </label>
          <label>
            <input type="checkbox" name="platform_facebook" />
            Facebook Marketplace
          </label>
          <label>
            <input type="checkbox" name="platform_stockx" />
            StockX
          </label>
          <label>
            <input type="checkbox" name="platform_goat" />
            GOAT
          </label>
        </div>
        <span class="field-hint">Tick one or more platforms where you expect flips to work.</span>
      </div>
    </div>

    <!-- Sold listings -->
    <div class="optional-group">
      <div class="optional-header">
        <span class="optional-header-main">Sold listings</span>
        <label class="optional-toggle">
          <input type="checkbox" name="includeSoldListings" id="includeSoldListings" checked />
          Include
        </label>
      </div>

      <div class="optional-body" id="soldListingsSection">
        <span class="field-hint">
          Sold URLs appear only for the platforms you selected above.
        </span>

        <div id="sold-ebay" class="sold-url-field" style="display:none;">
          <label>
            eBay sold URL
            <input
              type="text"
              name="soldUrl_ebay"
              maxlength="300"
              placeholder="eBay sold results URL"
            />
          </label>
        </div>

        <div id="sold-facebook" class="sold-url-field" style="display:none;">
          <label>
            Facebook sold URL
            <input
              type="text"
              name="soldUrl_facebook"
              maxlength="300"
              placeholder="Facebook Marketplace sold link"
            />
          </label>
        </div>

        <div id="sold-stockx" class="sold-url-field" style="display:none;">
          <label>
            StockX sold URL
            <input
              type="text"
              name="soldUrl_stockx"
              maxlength="300"
              placeholder="StockX sales history link"
            />
          </label>
        </div>

        <div id="sold-goat" class="sold-url-field" style="display:none;">
          <label>
            GOAT sold URL
            <input
              type="text"
              name="soldUrl_goat"
              maxlength="300"
              placeholder="GOAT sales history link"
            />
          </label>
        </div>
      </div>
    </div>

    <!-- Description -->
    <div class="optional-group">
      <div class="optional-header">
        <span class="optional-header-main">Description</span>
        <label class="optional-toggle">
          <input type="checkbox" name="includeDescription" checked />
          Include
        </label>
      </div>
      <div class="optional-body">
          <textarea
            name="description"
            maxlength="1500"
            placeholder="Sizes, notes, stock insights, fees, timing etc."
          ></textarea>
        </label>
      </div>
    </div>

    <!-- Risk rating -->
    <div class="optional-group">
      <div class="optional-header">
        <span class="optional-header-main">Risk rating (1–5)</span>
        <label class="optional-toggle">
          <input type="checkbox" name="includeRiskRating" checked />
          Include
        </label>
      </div>
      <div class="optional-body">
          <select name="riskRating" class="risk-select">
            <option value="">Select…</option>
            <option value="1">1 – Very low</option>
            <option value="2">2 – Low</option>
            <option value="3">3 – Medium</option>
            <option value="4">4 – High</option>
            <option value="5">5 – Very high</option>
          </select>
          <span class="field-hint">1 = safest, 5 = highest risk / more speculative.</span>
        </label>
      </div>
    </div>

    <!-- Returns -->
    <div class="optional-group">
      <div class="optional-header">
        <span class="optional-header-main">Returns info</span>
        <label class="optional-toggle">
          <input type="checkbox" name="includeReturns" checked />
          Include
        </label>
      </div>
      <div class="optional-body">
          <textarea
            name="returnsInfo"
            maxlength="500"
            placeholder="e.g. 30-day free returns, outlet credit only, no returns on sale items etc."
          ></textarea>
        </label>
      </div>
    </div>

    <!-- Misc -->
    <div class="optional-group">
      <div class="optional-header">
        <span class="optional-header-main">Misc (discount codes, cashback, notes)</span>
        <label class="optional-toggle">
          <input type="checkbox" name="includeMisc" checked />
          Include
        </label>
      </div>
      <div class="optional-body">

          <textarea
            name="miscInfo"
            maxlength="500"
            placeholder="Discount codes, cashback %, stacking tricks, alerts etc."
          ></textarea>
        </label>
      </div>
    </div>

    <!-- Image -->
    <div class="optional-group">
      <div class="optional-header">
        <span class="optional-header-main">Image URL</span>
        <label class="optional-toggle">
          <input type="checkbox" name="includeImage" checked />
          Include
        </label>
      </div>

      <div class="optional-body">
     
          <input
            type="text"
            name="imageUrl"
            maxlength="400"
            placeholder="Direct image link (https://...)"
          />

      </div>
    </div>

    <!-- Staff password -->
    <label>
      Staff password
      <input
        type="password"
        name="authKey"
        required
        placeholder="Shared console password"
      />
      <span class="field-hint">Prevents randoms from posting if they find the link.</span>
    </label>

    <button type="submit">
      <span>Post lead</span>
      <span aria-hidden="true">↗︎</span>
    </button>

    <div id="status" class="status"></div>
  </form>

  <script>
    const form = document.getElementById('leadForm');
    const statusEl = document.getElementById('status');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = '';
      statusEl.className = 'status';

      const formData = new FormData(form);
      const payload = Object.fromEntries(formData.entries());

      const submitButton = form.querySelector('button[type="submit"]');
      submitButton.disabled = true;

      try {
        const res = await fetch('/.netlify/functions/post-lead', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload),
        });

        let data = {};
        try {
          data = await res.json();
        } catch (_) {}

        if (!res.ok) {
          statusEl.textContent = data.error || 'Failed to post lead.';
          statusEl.classList.add('error');
        } else {
          statusEl.textContent = data.message || 'Lead posted successfully.';
          statusEl.classList.add('success');
          form.reset();
        }
      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Network error posting lead.';
        statusEl.classList.add('error');
      } finally {
        submitButton.disabled = false;
      }
    });

    // --- dynamic sold listing visibility ---
    const includePlatforms = document.querySelector('input[name="includePlatforms"]');
    const includeSoldListings = document.querySelector('#includeSoldListings');

    const platformCheckboxes = {
      ebay: document.querySelector('input[name="platform_ebay"]'),
      facebook: document.querySelector('input[name="platform_facebook"]'),
      stockx: document.querySelector('input[name="platform_stockx"]'),
      goat: document.querySelector('input[name="platform_goat"]'),
    };

    const soldFields = {
      ebay: document.getElementById('sold-ebay'),
      facebook: document.getElementById('sold-facebook'),
      stockx: document.getElementById('sold-stockx'),
      goat: document.getElementById('sold-goat'),
    };

    function updateSoldFieldVisibility() {
      const platformsOn = includePlatforms.checked;
      const soldIncluded = includeSoldListings.checked;

      // If sold listings OR platforms are disabled → hide entirely
      if (!platformsOn || !soldIncluded) {
        Object.values(soldFields).forEach(div => div.style.display = 'none');
        return;
      }

      // Show only the sold URL inputs for platforms that are ticked
      for (const key of Object.keys(platformCheckboxes)) {
        if (platformCheckboxes[key].checked) {
          soldFields[key].style.display = 'block';
        } else {
          soldFields[key].style.display = 'none';
        }
      }
    }

    includePlatforms.addEventListener('change', updateSoldFieldVisibility);
    includeSoldListings.addEventListener('change', updateSoldFieldVisibility);
    for (const key of Object.keys(platformCheckboxes)) {
      platformCheckboxes[key].addEventListener('change', updateSoldFieldVisibility);
    }
    updateSoldFieldVisibility();
  </script>
</body>
</html>